<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shop</title>
    <link
      href="https://fonts.googleapis.com/css?family=Lato"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <link
      rel="stylesheet"
      href="https://unpkg.com/boxicons@latest/css/boxicons.min.css"
    />
    <link rel="stylesheet" href="/Styles/home.css" />
    <link rel="stylesheet" href="/Styles/prod-details.css" />
    <!-- <link rel="stylesheet" href="/Styles/category.css"> -->
  </head>

  <body>
    <header>
        <a href="index.html" class="brand">Koko&s</a>
        <ul class="navMenu">
            <li><a href="index.html">Home</a></li>
            <li><a href="products-list.html">Shop</a></li>
            <li><a href="ContactUS.HTML">Contact</a></li>
            <li><a href="AboutUs.html">About</a></li>
        </ul>

      <div class="nav-icon">
        <div class="search-box">
          <button class="btn-search"><i class="bx bx-search"></i></button>
          <input
            type="text"
            class="input-search"
            placeholder="Type to Search..."
          />
        </div>
        <div class="dropdown">
          <a href="#" class="dropbtn"><i class="bx bxs-user"></i></a>
          <div class="dropdown-content">
            <a href="signup.html" id="signup-link">Sign Up</a>
            <a href="login.html" class="login-link">Login</a>
            <a href="#" class="logout-btn">Log Out</a>
          </div>
        </div>
        <!-- <a href=""><i class="bx bx-search"></i></a> -->
        <!-- <a href="#"><i class="bx bxs-user"></i></a> -->
        <a id="cart-view"><i class="bx bx-cart"></i>
          <div class="notification-ellipse"></div>
        </a>

        <div class="bx bx-menu" id="menu-icon"></div>
      </div>
    </header>

    <div id="Wishpopup">
      <p>Added to Wish List </p>
      <i class="fa-solid fa-hand-holding-heart" id="wishPopUp"></i>
    </div>

    <div class="container">
      <div class="category-filters">
        <h3>Category</h3>
        <button class="filter-btn">
          <i class="fa-solid fa-filter"></i> Filter
        </button>
        <button class="clear-btn"><i class="fa-solid fa-filter-circle-xmark"></i></button>
        <label class="category-filter">
          <p>Electronics</p>
          <input type="checkbox" class="box" value="electronics" />
          <span class="checkmark"></span>
        </label>
        <label class="category-filter">
          <p>Men's clothing</p>
          <input type="checkbox" class="box" value="men's clothing" />
          <span class="checkmark"></span>
        </label>
        <label class="category-filter">
          <p>Jewelery</p>
          <input type="checkbox" class="box" value="jewelery" />
          <span class="checkmark"></span>
        </label>
        <label class="category-filter">
          <p>Woman's clothing</p>
          <input type="checkbox" class="box" value="women's clothing" />
          <span class="checkmark"></span>
        </label>
      </div>

      <div class="product-container">
        <div class="listProduct"></div>
        <div class="loading">
          <img src="/imgs/load.gif" alt="" width="60px" height="60px" />
        </div>
      </div>
    </div>
    <!-- footer section -->
    <section class="contact" style="background-color:#e7e4f8 ;">
      <div class="contact-info">
        <div class="first-info">
          <a href="#" class="brand">Koko&s</a>
        </div>
        <div class="second-info">
          <h2>catagories</h2>
          <div id="catagory" class="category">
           <a href="./men's clothing.html"><p>Men's Clothing</p></a>
           <a href="./jewelery.html"><p>Jewelery</p></a>
           <a href="./electronics.html"><p>Electronics</p></a>
           <a href="./women's clothing.html"><p>Women's Clothing</p></a>
          </div>
        </div>
        <div class="third-info">
          <h2>customer care</h2>
          <p>my account</p>
          <p>discount</p>
          <p>returns</p>
          <p>order history</p>
        </div>
        <div class="fourht-info">
          <h2>pages</h2>
          <p>blog</p>
          <p>browse the shope</p>
          <p>category</p>
          <p>pre-built pages</p>
        </div>
      </div>
    </section>

    <footer>
      <div id="footer" class="footer">
        <p>copyright &copy; 2024 <span>koko&s</span>. all rights reserved</p>
        <div class="info-icon">
          <a href="#"><i class="bx bxl-facebook-circle"></i></a>
          <a href="#"><i class="bx bxl-twitter"></i></a>
          <a href="#"><i class="bx bxl-linkedin-square"></i></a>
        </div>
      </div>
    </footer>
    <div id="logOutPopUp">
      <p>You left usðŸ¥º come back soon </p>
    </div>
    <div id="emptySearch">
      <p>How about we fill that search bar with something spectacular instead?ðŸ˜œ</p>
    </div>
    <!-- <script type="module" src="/javaScript/home.js"></script> -->
    <script type="module" src="../javaScript/products.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script type="module">
       class WishListObj {
        constructor(image, price, title) {
          this.image = image;
          this.price = price;
          this.title = title;
          
        }
    }
      import { dataParse } from "../javaScript/products.js";
      var cards = document.querySelector(".product-container");
      var loading = document.querySelector(".loading");
      // var page = 1; // Keep track of the current page
      // var productsPerPage = 8;
      window.onload = function () {
        getData();
      };
      function getData() {
        loading.style.display = "flex";
        let products = null;
        // get datas from file json
        //https://fakestoreapi.com/products?limit=${productsPerPage}&page=${page}
        fetch("https://fakestoreapi.com/products", { method: "GET" })
          .then((response) => response.json())
          .then((data) => {
            products = data;

            function addDataToHTML() {
              // remove datas default from HTML
              let listProductHTML = document.querySelector(".listProduct");

                        // add new datas
                        if (products != null) // if has data
                        {
                            products.forEach(product => {
                                let newProduct = document.createElement('div');
                                // newProduct.href = 'detail.html?id=' + product.id;
                                newProduct.classList.add('item');
                                newProduct.innerHTML =
                                    `
                                    <a href='detail.html?id=${product.id}'>
                    <img src='${product.image}' alt='' style='mix-blend-mode: multiply; padding-bottom: 5px;' width='100' height='200' loading='lazy'>
                </a>
                            <h2>${product.title}</h2>
                            <div class="prices">EGP ${product.price}
                            </div>
                           <i class="bx bx-heart wishList heart" style="color:#FB2E86;"></i>
                            `;

                  listProductHTML.appendChild(newProduct);
                });
              }
            }
            addDataToHTML();
            loading.style.display = "none";
            // page++;
          }).then(()=>{
            let icons =document.querySelectorAll('.heart');
            icons.forEach(icon => {
              icon.onclick=function(){
                let price=this.parentNode.querySelector('.prices').textContent
                let title=this.parentNode.querySelector('h2').textContent
                let image=this.parentNode.querySelector('img').src
                var obj = new WishListObj(image, price, title);
          var wishList = JSON.parse(localStorage.getItem("wishList")) || {};
          wishList[`${obj.title}`] = obj;
          localStorage.setItem('wishList',JSON.stringify(wishList));
               
          var $Wishpopup = $("#Wishpopup");
          $Wishpopup.fadeIn(500, function () {
            $(this).delay(1000).fadeOut(500);
          });
              }
            });
          })
          .catch((error) => {
            console.error("Error fetching data:", error);
            loading.innerHTML = "Error loading data.";
          });
      }
      let checkBoxes = document.getElementsByTagName("input");
      let catArr = new Array();
      for (let i = 0; i < checkBoxes.length; i++) {
        const checkbox = checkBoxes[i];
        checkbox.addEventListener("click", function () {
          if (catArr.includes(checkbox.value)) {
            catArr.splice(catArr.indexOf(checkbox.value.toLowerCase()), 1);
          } else {
            catArr.push(checkbox.value);
            // console.log(catArr);
          }
        });

        // function getNewData() {
        //     productsPerPage += 8; // Increment the number of products to load
        //         getData();
        //     // setTimeout(() => {
        //     //     // products = products + 1;
        //     //     // console.log(products);

        //     // }, 500);
        // }
        // window.onscroll = function () {
        //     const { scrollTop, scrollHeight, clientHeight } =
        //         document.documentElement;
        //     if (scrollTop + clientHeight >= scrollHeight -10) {
        //         getNewData();
        //     }
        // }
      }
      let catResult = [];
      async function filterByCategory(category) {
        let data = await dataParse();
        for (let i = 0; i < data.length; i++) {
          const product = data[i];
          if (product.category == category) {
            catResult.push(product);
            // console.log(catResult);
          }
        }
      }
      let filterBtn = document.querySelector(".filter-btn");
      filterBtn.onclick = async function () {
        for (let i = 0; i < catArr.length; i++) {
          const cat = catArr[i];
          await filterByCategory(cat);
        }
        // console.log(catResult.length);
        function addDataToHTML() {
          // remove datas default from HTML
          document.querySelector(".listProduct").remove();
          let listProductHTML = document.createElement("div");
          listProductHTML.className = ".listProduct";
          listProductHTML.style.display = "grid";
          listProductHTML.style.gridTemplateColumns = "repeat(4, 1fr)";
          listProductHTML.style.gap = "20px";
          // console.log(catResult);
          // add new datas
          if (catResult != null) {
            // if has data
            catResult.forEach((product) => {
              let newProduct = document.createElement('div');
                                // newProduct.href = 'detail.html?id=' + product.id;
                                newProduct.classList.add('item');
                                newProduct.innerHTML =
                                    `
                                    <a href='detail.html?id=${product.id}'>
                    <img src='${product.image}' alt='' style='mix-blend-mode: multiply; padding-bottom: 5px;' width='100' height='200' loading='lazy'>
                </a>
                            <h2>${product.title}</h2>
                            <div class="prices">EGP ${product.price}
                            </div>
                           <i class="bx bx-heart wishList heart" style="color:#FB2E86;"></i>
                            `;

                  listProductHTML.appendChild(newProduct);
            });
          }
          document
            .querySelector(".product-container")
            .appendChild(listProductHTML);
        }
        addDataToHTML();
      };
      let clearBtn = document.querySelector(".clear-btn");
      clearBtn.addEventListener("click", function () {
        window.location.reload();
      });
      const header = document.querySelector("header");

      window.addEventListener("scroll", function () {
        header.classList.toggle("sticky", this.window.scrollY > 0);
      });

      let menu = document.querySelector("#menu-icon");
      let navMenu = document.querySelector(".navMenu");
      menu.onclick = () => {
        menu.classList.toggle("bx-x");
        navMenu.classList.toggle("open");
      };
    </script>
    <script src="../javaScript/auth.js"></script>
    <script type="module" src="../javaScript/products.js"></script>
    <script type="module">
      import { dataParse, escapeRegExp } from "../javaScript/products.js";
      async function attachLogicToSearchBtn() {
        let searchBtn = document.querySelector(".btn-search");
        let data = await dataParse();
        searchBtn.onclick = function () {
          // console.log(data);
          let searchVal = document.querySelector(".input-search").value;
          if (searchVal == "") {
            var $popupContainer = $("#emptySearch");
            $popupContainer.fadeIn(500, function () {
            $(this).delay(1000).fadeOut(5000);
              });
          } else {
            let searchResultArr = [];
            let regex = new RegExp(escapeRegExp(searchVal), "i");
            data.forEach((product) => {
              const match = product.title.match(regex);
              if (match) {
                searchResultArr.push(product);
              }
            });
            function buildResult(data) {
              document.querySelector(".listProduct").remove();
              let listProductHTML = document.createElement("div");
              listProductHTML.className = "listProduct";
              listProductHTML.style.display = "grid";
              listProductHTML.style.gridTemplateColumns = "repeat(4, 1fr)";
              listProductHTML.style.gap = "20px";
              // console.log(catResult);
              // add new datas
              if (data != null) {
                // if has data
                data.forEach((product) => {
                  let newProduct = document.createElement('div');
                                // newProduct.href = 'detail.html?id=' + product.id;
                                newProduct.classList.add('item');
                                newProduct.innerHTML =
                                    `
                                    <a href='detail.html?id=${product.id}'>
                    <img src='${product.image}' alt='' style='mix-blend-mode: multiply; padding-bottom: 5px;' width='100' height='200' loading='lazy'>
                </a>
                            <h2>${product.title}</h2>
                            <div class="prices">EGP ${product.price}
                            </div>
                           <i class="bx bx-heart wishList heart" style="color:#FB2E86;"></i>
                            `;

                  listProductHTML.appendChild(newProduct);
                  document
                    .querySelector(".product-container")
                    .appendChild(listProductHTML);
                });
              }
            }
            console.log(searchResultArr);
            buildResult(searchResultArr);
          }
        };
      }
      attachLogicToSearchBtn();
    </script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script type="module" src="../javaScript/products.js"></script>
    <script type="module">
      import {cartNotification} from '../javaScript/products.js'
      cartNotification();
    </script>
    <script type="module" src="../javaScript/wishList.js"></script>
    <!-- <script>
      let loginStatus =false ;
      var logOutButton = document.querySelector(".logout-btn");
      logOutButton.addEventListener("click", () => {
        loginStatus = false;
      });
    </script> -->

</body>

</html>
